<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Document</title>

    <style>

        #main{
            display: flex;
            margin: auto;
        }
        form{
            width: 40%  ;
            margin: auto;
        }
        
    </style>

</head>

<body>

    <div id="main">

        <div>

            <form onsubmit="reg()">

                <input type="text"      id="name"   placeholder="Enter name"/>
                <input type="email"     id="mail"   placeholder="Enter @Email"/>
                <input type="text"      id="userId" placeholder="id"/>
                <input type="password"  id="pass"   placeholder="password"/>
                <input type="number"    id="mobile" placeholder="number"/>
                <input type="text"      id="dis"    placeholder="discription"/>
                <input type="submit" />

            </form>

        </div>

        <div>

            <form onsubmit="login(event)">

                <input type="text"     id="username-log" placeholder="userId"/>
                <input type="password" id="password-log" placeholder="password"/>
                <input type="submit"/>

            </form>

        </div>

    </div>

</body>

</html>

<script>

    // main url https://masai-api-mocker.herokuapp.com/ 
    // register url https://masai-api-mocker.herokuapp.com/auth/register 
    // login url https://masai-api-mocker.herokuapp.com/auth/login

    async function reg(){

        try{

            event.preventDefault();

            var reg_data = {
                name: document.querySelector("#name").value,
                email: document.querySelector("#mail").value,
                password: document.querySelector("#pass").value,
                username: document.querySelector("#userId").value,
                mobile: document.querySelector("#mobile").value,
                description: document.querySelector("#dis").value
            };

            reg_data = JSON.stringify(reg_data)
            console.log('reg_data', reg_data);

        }

        catch(e){
            console.log('e', e);
        }

        let regApi = `https://masai-api-mocker.herokuapp.com/auth/register`

        let res = await fetch(regApi, {
            method: "POST",
            body: reg_data,
            headers: {
                "Content-Type": 'application/json'
            },
        
        });

        let data = await res.json()
        console.log('data', data);

    }     
 
    async function login(e){

        e.preventDefault()

        let data_list = {
            username: document.querySelector("#username-log").value,
            password: document.querySelector("#password-log").value,
        };

        data_list = JSON.stringify(data_list);
        console.log('data_list', data_list);
       let url = `https://masai-api-mocker.herokuapp.com/auth/login`

        let responce = await fetch (url,{
            method:'POST',
            body:data_list,
            headers:{
                "Content-Type":'application/json',
            },

        })

        let info = await responce.json()

        let token = info.token;

        let username = document.querySelector("#username-log").value

        getid(username,token)   

    }

    async function getid(value,token){

        let api = `https://masai-api-mocker.herokuapp.com/user/${value}`

        let res = await fetch(api,{

            headers: {
                "Content-Type": 'application/json',
                Authorization :`Bearer ${token}`
            },

        });

        let data = await res.json()

        console.log('data', data);

    }

</script>